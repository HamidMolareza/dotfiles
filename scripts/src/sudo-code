#!/bin/bash
# Usage: ./edit-as-root.sh <file-path>
# Safely edit a root-owned file in VS Code without running the entire editor as root.

set -euo pipefail

# Colors
RED="\033[0;31m"
GREEN="\033[0;32m"
YELLOW="\033[1;33m"
NC="\033[0m" # No Color

if [ $# -ne 1 ]; then
    echo -e "${YELLOW}Usage:${NC} $0 <file-path>"
    exit 1
fi

FILE="$1"

if [ ! -e "$FILE" ]; then
    echo -e "${RED}Error:${NC} File '$FILE' does not exist."
    exit 1
fi

if ! command -v code >/dev/null 2>&1; then
    echo -e "${RED}Error:${NC} VS Code ('code') command not found. Make sure it's in your PATH."
    exit 1
fi

if [ "$FILE" = "/etc/sudoers" ]; then
    echo -e "${YELLOW}Warning:${NC} Editing /etc/sudoers directly can lock you out of sudo if you make a syntax error."
    echo -e "It is strongly recommended to use 'visudo' (which is actually sudoedit for sudoers) as it validates syntax before saving."
    read -rp "Do you want to use visudo for this file? [y/N]: " choice
    if [[ "$choice" =~ ^[Yy]$ ]]; then
        sudo visudo
        exit 0
    fi
fi

# sudoedit does not require sudo to run sudoedit itself; you only prefix with sudo for permissions.
EDITOR="code --wait" sudoedit "$FILE"
